+++
title = 'Functions in Matlab函数漫谈'
date = 2024-09-04T14:31:59+08:00
draft = false
mathjax = true
categories = ['matlab']
tags = ['Matlab','函数','编程', '编程','输入参数', '输出参数', '变参数', '匿名函数', '闭包']
toc = true
tocBorder = true
+++


## Matlab程序设计

Matlab本质上是一个计算器,一个可以计算矩阵的计算器.Matlab中的浮点数不过是一个类型为浮点, 大小为 $1,1,1,1,\ldots$ 的数组(可以是1维,2维,3维,...到无穷维).而我们工程人员,领域专家最喜欢的就是计算器,三下五除二,把拍脑袋这个事情弄得更加有依据是我们这些个行当中最体现水平的事情.当然,你很不科学地拍脑袋但是能解决问题也是可以的.

在计算器的基础上,要想定制自己的计算器是很自然的事情,这就是Matlab程序设计. 当使用Matlab程序设计时,基本上就是指编函数,也就是函数式程序设计.

虽然Matlab填填补补弄了些`Class`之类的玩意,但是Matlab很长时间也就是个提供了一点函数自定义功能的计算器,要知道它很多年连个正经的数据结构都没有,什么栈,队列,树,图都没有......

那么我们在进一步深入地探索一下Matlab中的函数概念和函数工具.



## 脚本与函数与文件


> **约定:Matlab中,一个文件就自动形成一个可以运行的命令或者可以调用的函数,调用方式就是文件名（去掉后缀）.**

当然,脚本和函数区分的约定就在于文件头.一个文件的第一个有效行是一个`function`定义,那么这个文件就是一个函数,否则就是一个脚本.

在Matlab命令行中输入`edit filename`,就可以编辑一个文件,如果这个文件在*搜索目标*中不存在,那么Matlab会提示创建一个新文件.

### 搜索目录

上面提到的第一个概念就是*搜索目录*,Matlab在搜索目录中查找文件.如果使用过任何shell,那么这个概念就很熟悉了.

Matlab的搜索目录是一个cell数组,可以通过`path`函数查看搜索目录,通过`addpath`和`rmpath`函数添加和删除搜索目录.

跟搜索路径相关的函数`addpath`, `matlabroot`, `restoredefaultpath`, `pathtool`, `rehash`, `rmpath`.利用Matalb的帮助系统查看这些函数的用法.

### 脚本
脚本的后缀是`.m`,脚本文件的第一个有效行不是`function`定义.

在Matlab命令行中输入文件名（去掉.m后缀）,就可以运行这个脚本文件.Matlab解释器会从前到后执行文件中的所有语句.


### 函数

函数的后缀是`.m`,函数文件的第一个有效行是`function`定义.函数定义的语法是:

```matlab
function [out1, out2, ...] = myfun(in1, in2, ...)
```

其中,`myfun`是函数名,`out1, out2, ...`是输出参数,`in1, in2, ...`是输入参数.

> **约定:函数文件的文件名和函数名一致,最好这么做.**

函数文件的文件名是函数名,如果函数名和文件名不一致,那么Matlab解释器会根据文件名来调用函数,并且在编辑函数代码时,会提醒修改函数名称.

## 函数

除了上面给出的函数方式,还有另外几种函数定义方式.

### 匿名函数

匿名函数是一种简单的函数定义方式,语法是:

```matlab
f = @(x) x^2
```

这个语句定义了一个函数`f`,这个函数接受一个参数`x`,返回`x^2`.

### 函数句柄

函数句柄是一种函数的引用方式,可以用来传递函数,或者在函数中调用函数.函数句柄的定义方式是:

```matlab
f = @myfun
```

这个语句定义了一个函数句柄`f`,指向函数`myfun`.

在某些时候,还能通过字符串来定义函数句柄,这个时候就需要用到`str2func`函数.

```matlab
f = str2func('myfun')
```

在某些场合,这个函数会自动被调用,当需要得到函数句柄时,传递同名的字符串,就会自动转换为函数句柄.

```matlab
f = 'myfun'
```

### 函数调用

函数调用的方式跟定义函数的语句差不多,去掉`function`关键字.

```matlab
[out1, out2, ...] = myfun(in1, in2, ...)
```
> **约定:当函数的输入参数个数为0时,可以省略括号.**

这个约定非常好玩,因为这个时候函数调用就跟变量一样.实际上,这可以用来定义常量.

```matlab
function y = mypi()  % 这个括号也可以省略
    y = 3.14;
end
```

这个函数可以这样调用:

```matlab
mypi
```

也可以在计算式中直接使用`mypi`, 实际计算按照其返回值进行.

在举个例子,逻辑变量`true`和`false`就是这样类似的函数.

可以直接使用`true`和`false`,也可以用`true()`和`false()`,还可以输入参数`true(n1, n2)`和`false(n1, n2)`.

调用函数句柄的方式跟调用普通的函数一样,在函数句柄后面加上参数列表.

值得注意的的是,当把函数作为参数传递给另外一个函数的时候,可以使用函数句柄,也可以用`@`符号来访问搜索目标中的函数,还可以直接传递匿名函数,例如`@(x) x^2`,或者代表函数的字符串.

这里也要注意,当我们定义一个没有输入参数的匿名函数时,就不能通过这样的方式来调用,因为匿名函数句柄指向函数,把函数调用和访问函数句柄分开.

## 函数的输入输出

### 显式的输入和输出

在利用上面的`function`定义函数的时候,可以指定函数的输入和输出参数.函数的输入和输出参数是通过参数列表来指定的.

```matlab
function [out1, out2, ...] = myfun(in1, in2, ...)
```
函数的输入和输出个数可以通过`nargin`和`nargout`函数来获取.

```matlab
nargin('myfun')
nargout('myfun')

% or
nargin(@myfun) % 这个函数的输入参数个数
nargout(@myfun) % 这个函数的输出参数个数
```

当在一个函数的内部（就是在函数定义语句之后、对应的`end`之前）调用不带参数的`nargin`和`nargout`函数时,会返回当前函数的输入和输出参数个数.

### 隐式的输入和输出

函数的输入和输出可以通过参数列表来指定,也可以通过`varargin`和`varargout`来实现.组合使用这两个函数和`nargin`和`nargout`函数,可以实现函数的输入和输出参数的灵活控制.

```matlab
function varargout = arg_copy(varargin)
fprintf('%d --> %d \n', nargin, nargout);

if nargout == 0
    return;
else
    varargout = cell(1, nargout);
end

if nargin == 0 && nargout ~= 0
    varargout{1:nargout} = "Not defined";
    return;
end

if nargout <= nargin
    varargout(1:nargout) = varargin(1:nargout);
else
    varargout(1:nargin) = varargin(1:nargin);
    varargout{nargin+1:nargout} = "Not defined";
end
```

这个函数能够处理任意数量的输入和输出,并把输入逐一拷贝到输出.如果输入不够,那么输出就用`"Not defined"`来填充.

后面还要讲专门到`cell`数组,目前我们只需要知道`cell`数组是一种特殊的数组,可以存放任意类型的数据,也可以存放不同类型的数据.

而函数的输入和输出,都是采取跟`cell`数组类似的方式来处理的.

关于这个还值得专门写一个帖子,还有挺多好玩的东西.

## 结论


1. Matlab用文件来组织代码,一个文件就是一个可以运行的命令或者可以调用的函数.
2. 函数用`function`或者`@`的方式来定义.
3. 函数的输入和输出参数可以通过显式的参数列表来指定,也可以通过`varargin`和`varargout`来实现.
4. 建议遵守Matlab的函数命名约定,即函数文件的文件名和函数名一致,并且把函数的输入和输出参数都写在函数定义的第一行.





